---
- name: Installs VSCode on Linux
  hosts: localhost
  tasks:
    - name: Download VSCode .deb package
      ansible.builtin.get_url:
        url: https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64
        dest: /tmp/vscode.deb
        mode: "0644"

    - name: Verify that the .deb package is downloaded
      ansible.builtin.stat:
        path: /tmp/vscode.deb
      register: vscode_deb
      failed_when: not vscode_deb.stat.exists

    - name: Install VSCode package
      ansible.builtin.package:
        name: /tmp/vscode.deb
        state: present
      become: true

    - name: Clean up downloaded VSCode package
      ansible.builtin.file:
        path: /tmp/vscode.deb
        state: absent
